# HarmoniAI Frontend â€“ Copilot Guide
- **Stack & bootstrap**: Angular 20 with standalone components and Angular Material. App boots via [src/main.ts](src/main.ts) using `bootstrapApplication` with `provideRouter(routes)` and `provideHttpClient(withInterceptors([tokenInterceptor]))`; `AppRoutingModule` exists but is not used at runtime.
- **Routing**: Routes live in [src/app/app.routes.ts](src/app/app.routes.ts). Keep paths in sync with navbar links in [src/app/shared/navbar/navbar.html](src/app/shared/navbar/navbar.html). Hash routing is configured only in the unused module; prefer updating `routes` for actual navigation.
- **Layout shell**: Root component [src/app/app.ts](src/app/app.ts) renders the shared navbar and `RouterOutlet`. Navbar toggles a Material sidenav and provides links to all pages; adjust there when adding screens.
- **State pattern**: Components generally use Angular `signal()` for local state (see planner tasks components) and manual `subscribe` calls; async pipe is rarely used. Prefer sticking to signals for new local UI state to stay consistent.
- **UI modules**: Each standalone page/component declares its own Angular Material imports instead of shared modules. Match that pattern when adding UI.
- **Auth**: [src/app/services/auth.service.ts](src/app/services/auth.service.ts) posts to `https://localhost:44304/api/Auth` for signup/login, stores `token` and `user` in `localStorage`, and exposes `currentUser$` (BehaviorSubject). Token attachment is handled globally by [src/app/core/token.interceptor.ts](src/app/core/token.interceptor.ts) via `Authorization: Bearer <token>`.
- **Backend base URLs**: Most services hardcode `https://localhost:44304` (Auth, Habits, Planner, Journal); only `SettingsService` uses [src/environments/environments.ts](src/environments/environments.ts). Keep endpoints aligned or centralize before changing domains.
- **Planner**: Planner tabs are composed in [src/app/pages/planner2/planner2.ts](src/app/pages/planner2/planner2.ts) and use [src/app/services/task.service.ts](src/app/services/task.service.ts) (PlannerService) against `/api/planner`. Data shapes live in [src/app/models/api.d.ts](src/app/models/api.d.ts). Components mutate signal arrays after CRUD calls; mirror that pattern.
- **Habits**: [src/app/pages/habits/habits.ts](src/app/pages/habits/habits.ts) uses [src/app/services/habit.service.ts](src/app/services/habit.service.ts) with CRUD endpoints `/api/habits` and models from [src/app/models/habit.model.ts](src/app/models/habit.model.ts). UI toggles days and pushes updates immediately to the API.
- **Journal**: [src/app/pages/journal/journal.ts](src/app/pages/journal/journal.ts) calls [src/app/services/journal.service.ts](src/app/services/journal.service.ts); requests require a `userId` query parameter (currently hardcoded). Updates and deletes go directly through the service and mutate the local array.
- **AI page**: [src/app/pages/ai/ai.ts](src/app/pages/ai/ai.ts) is static data-driven; follow its structure for card-based insights.
- **Settings**: [src/app/services/settings.service.ts](src/app/services/settings.service.ts) targets `/api/v1/Settings` using the `apiBaseUrl` environment; models in [src/app/models/api.d.ts](src/app/models/api.d.ts).
- **Authentication flow**: Login and signup forms ([src/app/pages/login/login.ts](src/app/pages/login/login.ts), [src/app/pages/signup/signup.ts](src/app/pages/signup/signup.ts)) use reactive forms with inline validation and route to `/` on success. Errors surface in `errorMessage` strings; keep error handling consistent.
- **Models**: Core interfaces for planner tasks and settings live in [src/app/models/api.d.ts](src/app/models/api.d.ts); auth/user models in [src/app/models/auth-response.model.ts](src/app/models/auth-response.model.ts) and [src/app/models/user.model.ts](src/app/models/user.model.ts). Reuse these rather than redefining shapes.
- **Styling**: Component-scoped SCSS per page (e.g., planner tabs under `src/app/pages/planner2/**`). Global styling hooks live in [src/styles.scss](src/styles.scss) (check before adding global tokens). Prettier enforces `printWidth: 100` and `singleQuote: true` with Angular HTML parser for templates.
- **Build/test commands**: Use npm scripts: `npm start` (ng serve), `npm run build`, `npm run test`, `npm run watch` for dev builds. Angular CLI is available via `npm run ng`.
- **Data flow expectations**: Most components optimistically update local state after successful HTTP responses (push/splice then `set`). Keep this pattern to avoid change-detection surprises.
- **Storage**: Auth token and user are the only localStorage keys currently used; clear both on logout via `AuthService.logout()`.
- **Gotchas**:
  - Router provided twice (module vs standalone); the live config is the one in `bootstrapApplication`.
  - Services are `providedIn: 'root'` but some components list them in `providers` to force fresh instances; be mindful when sharing state.
  - Backend expects ISO-like date strings for planner tasks (see `startDate` notes in [src/app/models/api.d.ts](src/app/models/api.d.ts)).
