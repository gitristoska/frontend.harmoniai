<section class="planner-page page-container">
  <!-- Welcome card -->
  <mat-card class="welcome">
    <h2>{{ heading() }}</h2>
    <p class="subtitle">{{ subtitle() }}</p>
  </mat-card>

  <!-- Add Task card -->
  <mat-card class="add-task">
    <ng-container *ngIf="!showForm">
      <button mat-button class="add-btn" (click)="addNewTask()">
        <mat-icon>add</mat-icon> Add New Task
      </button>
    </ng-container>

    <ng-container *ngIf="showForm">
      <div class="new-task">
        <mat-form-field appearance="outline" style="width:100%">
          <mat-label>Task Title</mat-label>
          <input matInput placeholder="What do you need to do?" [(ngModel)]="newTask.title" />
        </mat-form-field>

        <mat-form-field appearance="outline" style="width:100%">
          <mat-label>Description</mat-label>
          <textarea matInput placeholder="Optional description" [(ngModel)]="newTask.description"></textarea>
        </mat-form-field>

        <div class="row">
          <mat-form-field appearance="outline" class="col">
            <mat-label>Priority</mat-label>
            <mat-select [(ngModel)]="newTask.priority">
              <mat-option value="0">Low</mat-option>
              <mat-option value="1">Medium</mat-option>
              <mat-option value="2">High</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col">
            <mat-label>Category</mat-label>
            <mat-select [(ngModel)]="newTask.category">
              <mat-option value="work">Work</mat-option>
              <mat-option value="study">Study</mat-option>
              <mat-option value="finance">Finance</mat-option>
              <mat-option value="meal">Meal</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="row">
          <mat-form-field appearance="outline" class="col time-col">
            <mat-label>Date</mat-label>
            <input matInput type="date" [(ngModel)]="newTask.date" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="col time-col">
            <mat-label>Time (optional)</mat-label>
            <input matInput type="time" [(ngModel)]="newTask.time" />
          </mat-form-field>
        </div>

        <div class="actions">
          <button mat-button color="primary" class="full" (click)="submitAddTask()">Add Task</button>
          <button mat-button (click)="cancelNewTask()">Cancel</button>
        </div>
      </div>
    </ng-container>
  </mat-card>

  <!-- Tasks list -->
  <mat-card class="tasks">
    <h3>Your Tasks ({{ tasks().length }})</h3>
    <div class="tasks-list">
      <div *ngFor="let t of tasks(); let i = index" class="task-row">
        <button mat-icon-button (click)="toggleDone(i)">
          <mat-icon *ngIf="t.isDone">check_circle</mat-icon>
          <mat-icon *ngIf="!t.isDone">radio_button_unchecked</mat-icon>
        </button>
        <div class="task-main">
          <div class="task-title" [class.done]="t.isDone">{{ t.title }}</div>
          <div class="task-meta">{{ t.scheduledAt | date:'short' }} â€¢ {{ t.category }}</div>
          <div class="task-desc" *ngIf="t.description">{{ t.description }}</div>
        </div>
        <div class="task-right">
          <div
            class="badge"
            [class.high]="t.priority===2"
            [class.medium]="t.priority===1"
            [class.low]="t.priority===0"
          >
            {{ t.priority === 0 ? 'low' : t.priority === 1 ? 'medium' : 'high' }}
          </div>
          <button mat-icon-button color="warn" (click)="deleteTask(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </mat-card>
</section>
