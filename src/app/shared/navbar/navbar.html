<mat-sidenav-container class="sidenav-container">
  <!-- Sidenav Drawer (Mobile) -->
  <mat-sidenav
    #drawer
    class="sidenav"
    mode="over"
    [opened]="showSidenav"
    (closedStart)="showSidenav = false"
  >
    <mat-nav-list *ngIf="isLoggedIn()">
      <a mat-list-item routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="toggleSidenav()">
        <mat-icon>home</mat-icon>
        <span>Home</span>
      </a>
      <a mat-list-item routerLink="/planner" routerLinkActive="active" (click)="toggleSidenav()" [class.disabled]="!modules().planner" [style.pointer-events]="!modules().planner ? 'none' : 'auto'" [style.opacity]="!modules().planner ? '0.5' : '1'">
        <mat-icon>event_note</mat-icon>
        <span>Planner</span>
      </a>
      <a mat-list-item routerLink="/journal" routerLinkActive="active" (click)="toggleSidenav()" [class.disabled]="!modules().journal" [style.pointer-events]="!modules().journal ? 'none' : 'auto'" [style.opacity]="!modules().journal ? '0.5' : '1'">
        <mat-icon>menu_book</mat-icon>
        <span>Journal</span>
      </a>
      <a mat-list-item routerLink="/habits" routerLinkActive="active" (click)="toggleSidenav()" [class.disabled]="!modules().habits" [style.pointer-events]="!modules().habits ? 'none' : 'auto'" [style.opacity]="!modules().habits ? '0.5' : '1'">
        <mat-icon>check_circle</mat-icon>
        <span>Habits</span>
      </a>
      <a mat-list-item routerLink="/ai" routerLinkActive="active" (click)="toggleSidenav()">
        <mat-icon>smart_toy</mat-icon>
        <span>AI</span>
      </a>
      <a mat-list-item routerLink="/settings" routerLinkActive="active" (click)="toggleSidenav()">
        <mat-icon>settings</mat-icon>
        <span>Settings</span>
      </a>
      <mat-divider></mat-divider>
      <a mat-list-item (click)="logout(); toggleSidenav()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Navbar -->
  <mat-toolbar class="navbar">
    <button mat-icon-button class="menu-button" (click)="toggleSidenav()" *ngIf="isLoggedIn()">
      <mat-icon>menu</mat-icon>
    </button>

    <div class="brand">
      <div class="sparkles" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles" aria-hidden="true"><path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"></path><path d="M20 2v4"></path><path d="M22 4h-4"></path><circle cx="4" cy="20" r="2"></circle></svg>
      </div>
      <span class="logo">Harmoni<span class="ai">AI</span></span>
    </div>

    <span class="spacer"></span>

    <!-- Desktop menu (logged in) -->
    <div class="nav-links" *ngIf="isLoggedIn()">
      <button mat-button routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <mat-icon>home</mat-icon>
        Home
      </button>
      <button mat-button routerLink="/planner" routerLinkActive="active" [disabled]="!modules().planner">
        <mat-icon>event_note</mat-icon>
        Planner
      </button>
      <button mat-button routerLink="/journal" routerLinkActive="active" [disabled]="!modules().journal">
        <mat-icon>menu_book</mat-icon>
        Journal
      </button>
      <button mat-button routerLink="/habits" routerLinkActive="active" [disabled]="!modules().habits">
        <mat-icon>check_circle</mat-icon>
        Habits
      </button>
      <button mat-button routerLink="/ai" routerLinkActive="active">
        <mat-icon>smart_toy</mat-icon>
        AI
      </button>
      <button mat-button routerLink="/settings" routerLinkActive="active">
        <mat-icon>settings</mat-icon>
        Settings
      </button>
    </div>

    <!-- User menu (logged in) -->
    <div class="user-menu" *ngIf="isLoggedIn() && (currentUser$ | async) as user">
      <button mat-icon-button [matMenuTriggerFor]="menu" class="user-button">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <div mat-menu-item disabled class="user-info">
          <strong>{{ user.fullName }}</strong>
          <p>{{ user.email }}</p>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/settings">
          <mat-icon>settings</mat-icon>
          <span>Settings</span>
        </button>
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>

    <!-- Auth buttons (not logged in) -->
    <div class="auth-buttons" *ngIf="!isLoggedIn()">
      <button mat-button routerLink="/login">Sign In</button>
      <button mat-raised-button color="primary" routerLink="/signup">Sign Up</button>
    </div>
  </mat-toolbar>

  <div class="content">
    <router-outlet></router-outlet>
  </div>
</mat-sidenav-container>
